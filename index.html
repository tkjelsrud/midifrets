<html>
  <head>
    <script type="text/javascript">
      /*
      Theme 
      Darker #202225
      Dark bg #424242
      Light grey #606368
      
      Text #D1D1D1
      
      Green hl #04DAC6
      Pink hl #EA80FB
      Orange hl #FD8E31
      */
      
      // Variable which tell us what step of the game we're on.
      // We'll use this later when we parse noteOn/Off messages
      var currentStep = 0;
      var noteBuffer = new Array();

      // Request MIDI access
      if (navigator.requestMIDIAccess) {
          console.log('This browser supports WebMIDI!');

          navigator.requestMIDIAccess().then(onMIDISuccess, onMIDIFailure);

      } else {
          console.log('WebMIDI is not supported in this browser.');
      }

      // Function to run when requestMIDIAccess is successful
      function onMIDISuccess(midiAccess) {
          var inputs = midiAccess.inputs;
          var outputs = midiAccess.outputs;

          // Attach MIDI event "listeners" to each input
          for (var input of midiAccess.inputs.values()) {
              input.onmidimessage = getMIDIMessage;
          }
      }

      // Function to run when requestMIDIAccess fails
      function onMIDIFailure() {
          console.log('Error: Could not access MIDI devices.');
      }

      // Function to parse the MIDI messages we receive
      // For this app, we're only concerned with the actual note value,
      // but we can parse for other information, as well
      function getMIDIMessage(message) {
          var command = message.data[0];
          var note = message.data[1];
          var velocity = (message.data.length > 2) ? message.data[2] : 0;
		
          switch (command) {
              case 144: // note on
                  if (velocity > 0) {
                      //console.log(new Date().getMilliseconds() + " " + command + ":" + note + ":" + velocity);
                      noteOn(note);
                  } else {
                      noteOff(note);
                  }
                  break;
              case 128: // note off
                  noteOff(note);
                  break;
              // we could easily expand this switch statement to cover other types of commands such as controllers or sysex
          }
      }

      // Function to handle noteOn messages (ie. key is pressed)
      // Think of this like an 'onkeydown' event
      function noteOn(note) {
          noteBuffer[note] = 1;
      }

      // Function to handle noteOff messages (ie. key is released)
      // Think of this like an 'onkeyup' event
      function noteOff(note) {
        nArr = new Array();
        for(key in noteBuffer) {
         	nArr.push(noteToChord(key)); 
        }
        console.log(nArr); 
        //console.log(noteBuffer);
        noteBuffer = new Array();
      }

      // This function will trigger certain animations and advance gameplay
      // when certain criterion are identified by the noteOn/noteOff listeners
      // For instance, a lock is unlocked, the timer expires, etc.
      function runSequence(sequence) {
          //...
      }
      
      function noteToChord(noteId) {
       	n = noteId % 12;
        ch = new Array("C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B");
        return ch[n];
      }
      
      function chordToScale(chord) {
       	x = "1 2 3 4 5 6 7"; 
        // Assume a major scale, then replace all intervals to match
        
      }
      
      /*
      
Score	Root	Scale	Notes	Intervals	More Info
1	C	Major Scale	C,D,E,F,G,A,B	1 2 3 4 5 6 7	More info...
2	C	Natural Minor Scale (Aeolian Mode)	C,D,Eb,F,G,Ab,Bb	1 2 b3 4 5 b6 b7	More info...
3	C	Harmonic Minor Scale	C,D,Eb,F,G,Ab,B	1 2 b3 4 5 b6 7	More info...
4	C	Minor Blues Scale	C,Eb,F,F#,G,Bb	1 b3 4 4# 5 b7	More info...
5	C	Minor Pentatonic Scale	C,Eb,F,G,Bb	1 b3 4 5 b7	More info...
6	C	Melodic Minor Ascending (Jazz Melodic Minor)	C,D,Eb,F,G,A,B	1 2 b3 4 5 6 7	More info...
7	C	Major Pentatonic Scale	C,D,E,G,A	1 2 3 5 6	More info...
8	C	Phrygian Dominant Scale	C,Db,E,F,G,Ab,Bb	1 b2 3 4 5 b6 b7	More info...
9	C	Lydian Dominant Scale	C,D,E,F#,G,A,Bb	1 2 3 #4 5 6 b7	More info...
10	C	Mixolydian Mode	C,D,E,F,G,A,Bb	1 2 3 4 5 6 b7	More info...
11	C	Dorian Mode	C,D,Eb,F,G,A,Bb	1 2 b3 4 5 6 b7	More info...
12	C	Aeolian Mode (Natural Minor Scale)	C,D,Eb,F,G,Ab,Bb	1 2 b3 4 5 b6 b7	More info...
13	C	Phrygian Mode	C,Db,Eb,F,G,Ab,Bb	1 b2 b3 4 5 b6 b7	More info...
14	C	Lydian Augmented Scale	C,D,E,F#,G#,A,B	1 2 3 #4 #5 6 7	More info...
15	C	Altered Scale	C,C#,D#,E,F#,G#,A#	1 b2 b3 b4 b5 b6 b7	More info...
16	C	Lydian Mode	C,D,E,F#,G,A,B	1 2 3 #4 5 6 7	More info...
17	C	Locrian Mode	C,Db,Eb,F,Gb,Ab,Bb	1 b2 b3 4 b5 b6 b7	More info...
18	C	Half Diminished Scale	C,D,D#,E#,F#,G#,A#	1 2 b3 4 b5 b6 b7	More info...
*/
    
    </script>
    <style>
      body {
        background-color: #202225;
        color: ##D1D1D1;
      }
      .fretboard .col {
        float: left;
        width: 40px;
        border: 1px solid #606368;
      }
      
      .fretboard .col div {
        float: left;
        margin: 1px;
        width: 38px;
        background-color: #424242;
      }
    </style>
  </head>
  
  <body>
    <div class="fretboard">
    	<div class="col">
          <div>&nbsp;</div>
          <div>&nbsp;</div>
          <div>&nbsp;</div>
          <div>&nbsp;</div>
          <div>&nbsp;</div>
      </div>
      <div class="col">
          <div>&nbsp;</div>
          <div>&nbsp;</div>
          <div>&nbsp;</div>
          <div>&nbsp;</div>
          <div>&nbsp;</div>
      </div>
    </div>
  </body>
</html>
